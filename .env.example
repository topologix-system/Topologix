# Topologix Environment Configuration Template
#
# SECURITY NOTICE:
# - DO NOT commit .env to version control (already in .gitignore)
# - Set restrictive permissions: chmod 600 .env
# - Generate unique secrets for production (see JWT_SECRET_KEY comment)
# - Review SECURITY.md before deploying to production
#
# USAGE:
# Quick Start:
#   - Development: cp .env.development .env
#   - Production:  cp .env.production .env
#
# Or use docker-compose --env-file option:
#   - Development: docker compose --env-file .env.development up -d
#   - Production:  docker compose --env-file .env.production up -d
#
# Then start the containers:
#   docker compose up -d

# ============================================
# Backend Configuration
# ============================================

# Backend Command (Environment-specific)
# Development (Flask dev server with hot reload):
#   BACKEND_COMMAND=python app.py
# Production (Gunicorn WSGI server):
#   BACKEND_COMMAND=gunicorn --bind 0.0.0.0:5000 --workers 4 --threads 2 --timeout 120 --access-logfile - --error-logfile - --log-level info 'app:app'

FLASK_ENV=development
FLASK_DEBUG=True

BATFISH_HOST=batfish
BATFISH_PORT=9996

# CORS Origins (comma-separated)
# Add your frontend URLs here. For production, replace with your actual domain
# Example: CORS_ORIGINS=http://localhost:3000,https://yourdomain.com
CORS_ORIGINS=http://localhost:3000

# ============================================
# Authentication (Optional Feature)
# ============================================

AUTH_ENABLED=true

# Allow user self-registration (WARNING: anyone can create account when enabled)
# Set false to restrict registration to admin-only (more secure)
# Default: 'true' for easier OSS onboarding
ALLOW_REGISTRATION=true

# Default Admin Credentials (only used when AUTH_ENABLED=true)
# Leave AUTH_DEFAULT_ADMIN_PASS empty to trigger first-time setup wizard
AUTH_DEFAULT_ADMIN_USER=admin
AUTH_DEFAULT_ADMIN_PASS=

# JWT Secret Keys (auto-generated if not set, but should be set in production)
# Generate using: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
# SECRET_KEY=
# JWT_SECRET_KEY=
# CSRF_SECRET_KEY=

# CSRF protection: 'session' (stateful, default) or 'double-submit' (stateless)
# Double-submit recommended for scaled deployments. See SECURITY.md for details.
# CSRF_MODE=session

# JWT access token expiry in seconds (default: 3600 = 1 hour)
# OWASP ASVS L2: <12h, L3: <15min. For high-security: 900 (15min)
JWT_ACCESS_TOKEN_EXPIRES=3600

# ============================================
# Login Security Configuration
# ============================================

# Failed login attempts before account lockout (OWASP: 5-10, default: 5)
# Works with LOGIN_LOCKOUT_DURATION_MINUTES
# ACCOUNT_LOCKOUT_THRESHOLD=5

# Account lockout duration in minutes (default: 30)
# LOGIN_LOCKOUT_DURATION_MINUTES=30

# Login rate limit per IP (default: 10 within rate window)
# Set higher than per-user threshold for NAT/shared IP environments
LOGIN_MAX_ATTEMPTS_PER_IP=10

# Rate limit sliding window in minutes (default: 15)
LOGIN_RATE_WINDOW_MINUTES=15

# ============================================
# Email Configuration (for password reset, notifications, etc.)
# ============================================

# Email Provider: 'console' (print to console), 'smtp' (send via SMTP), 'disabled' (no email)
# Default: 'console' for development
EMAIL_PROVIDER=console

# Email From Address and Name
EMAIL_FROM=noreply@topologix.local
EMAIL_FROM_NAME=Topologix

# SMTP Configuration (only used when EMAIL_PROVIDER=smtp)
SMTP_HOST=localhost
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_USE_TLS=true

# Password Reset Configuration
# Token expiry time in seconds (default: 3600 = 1 hour)
PASSWORD_RESET_TOKEN_EXPIRY=3600

# Frontend base URL for password reset links
# Update this to match your frontend URL
PASSWORD_RESET_URL_BASE=http://localhost:3000

# ============================================
# Database Configuration (only used when AUTH_ENABLED=true)
# ============================================

# Database URL - supports SQLite, PostgreSQL, MySQL
# SQLite (default - good for development and small deployments):
DATABASE_URL=sqlite:////app/data/topologix.db

# PostgreSQL (recommended for production):
# DATABASE_URL=postgresql://username:password@postgres:5432/topologix

# MySQL:
# DATABASE_URL=mysql+pymysql://username:password@mysql:3306/topologix

# Notes:
# - When AUTH_ENABLED=false, database is not initialized
# - For Docker, use /app/data/topologix.db for SQLite to persist in volume
# - For PostgreSQL/MySQL, add service to docker-compose.yaml

# ============================================
# Frontend Configuration
# ============================================

# Backend API endpoint. Empty string uses nginx reverse proxy (recommended for production)
# Development: http://localhost:5000, Production: (empty)
VITE_API_BASE_URL=http://localhost:5000

# Authentication (must match backend AUTH_ENABLED)
VITE_AUTH_ENABLED=true

# Timezone for displaying dates (IANA timezone identifier)
# Default: Asia/Tokyo (JST, UTC+9)
# Examples: America/New_York, Europe/London, UTC
VITE_TIMEZONE=Asia/Tokyo

# ============================================
# Reverse Proxy Configuration
# ============================================

# Enable if behind reverse proxy (nginx/Caddy). Trusts X-Forwarded-For headers.
# WARNING: Enable only if proxy exists - otherwise allows IP spoofing attack!
# Must match infrastructure: nginx=true, direct=false (default: false for safety)
BEHIND_REVERSE_PROXY=false

# Proxy layers between client and backend (0=none, 1=nginx, 2=CDN+nginx, etc.)
# WARNING: Incorrect value allows IP spoofing! Count actual proxy hops.
# Default: 1 (single nginx in Docker). See DEPLOYMENT.md for multi-proxy setup.
# TRUSTED_PROXY_COUNT=1

# ============================================
# Docker Configuration
# ============================================

# Docker image override for custom registries/forks (CI/CD, custom deployments)
# Format: registry/namespace/image:tag
# Examples: ghcr.io/user/topologix/backend:latest, dockerhub/backend:v1.0.0
# BACKEND_IMAGE=ghcr.io/topologix-system/topologix/backend:latest
# FRONTEND_IMAGE=ghcr.io/topologix-system/topologix/frontend:latest

# ============================================
# Advanced Configuration
# ============================================

# Redis (for production caching and session storage)
# REDIS_URL=redis://localhost:6379/0

# Logging
# LOG_LEVEL=INFO
# LOG_FILE=topologix.log
# AUDIT_LOG_FILE=topologix_audit.log

# File Upload
# MAX_CONTENT_LENGTH=10485760  # 10MB in bytes
# UPLOAD_FOLDER=/tmp/topologix_uploads

# Paths
# SNAPSHOTS_DIR=/snapshots

# Testing Configuration
# Enable Flask testing mode (disables error catching for better test debugging)
# WARNING: Never enable in production! Only use during automated testing.
# FLASK_TESTING=false

# Port Configuration
# Override the default port for backend service
# Default: 5000 (standard Flask port)
# Note: When using Docker, this is typically handled by docker-compose.yaml
# PORT=5000